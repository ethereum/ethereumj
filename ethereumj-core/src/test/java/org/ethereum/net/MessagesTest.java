package org.ethereum.net;

import org.ethereum.core.Block;
import org.ethereum.core.Transaction;
import org.ethereum.crypto.ECKey;
import org.ethereum.crypto.HashUtil;
import org.ethereum.net.client.PeerData;
import org.ethereum.net.message.*;
import org.ethereum.util.ByteUtil;
import org.ethereum.util.RLP;
import org.ethereum.util.RLPList;
import org.junit.Ignore;
import org.junit.Test;
import org.spongycastle.util.encoders.Hex;

import java.io.File;
import java.io.IOException;
import java.math.BigInteger;
import java.net.URISyntaxException;
import java.net.URL;
import java.net.UnknownHostException;
import java.nio.file.Files;
import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNull;

public class MessagesTest {

    /* HELLO_MESSAGE */

    @Test /* HelloMessage 1 */
    public void test_1() {

        String helloMessageRaw = "F8 77 80 0C 80 AD 45 74 " +
                "68 65 72 65 75 6D 28 2B 2B 29 2F 5A 65 72 6F 47 " +
                "6F 78 2F 76 30 2E 35 2E 31 2F 6E 63 75 72 73 65 " +
                "73 2F 4C 69 6E 75 78 2F 67 2B 2B 07 82 76 5F B8 " +
                "40 D8 83 3B 83 56 0E 0B 12 17 0E 91 69 DC 43 78 " +
                "42 23 A5 98 42 DE 23 59 E6 D0 3D B3 4C 30 A9 66 " +
                "C2 DE 3B 4B 25 52 FB 0D 75 95 A1 85 D5 58 F2 E6 " +
                "69 B5 95 67 4F 52 17 C9 96 EE 14 88 84 82 8B E0 FD";
        byte[] payload = Hex.decode(helloMessageRaw);
        RLPList rlpList = RLP.decode2(payload);

        HelloMessage helloMessage = new HelloMessage(rlpList);
        helloMessage.parseRLP();
        System.out.println(helloMessage);

        assertEquals(12, helloMessage.getProtocolVersion());
        assertEquals(0, helloMessage.getNetworkId());
        assertEquals("Ethereum(++)/ZeroGox/v0.5.1/ncurses/Linux/g++", helloMessage.getClientId());
        assertEquals(7, helloMessage.getCapabilities());
        assertEquals(30303, helloMessage.getPeerPort());
        assertEquals(
            "D8833B83560E0B12170E9169DC43784223A59842DE2359E6D03DB34C30A966C2DE3B4B2552FB0D7595A185D558F2E669B595674F5217C996EE148884828BE0FD",
            Hex.toHexString(helloMessage.getPeerId()).toUpperCase() );
    }

    @Test /* HelloMessage 2 */
	public void test_2() {

        String helloMessageRaw = "F87F800B80B5457468657265756D282B2B292F76302E342E332F4554485F4255494C445F545950452F4554485F4255494C445F504C4154464F524D0782765FB840E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1";
        byte[] payload = Hex.decode(helloMessageRaw);
        RLPList rlpList = RLP.decode2(payload);

        HelloMessage helloMessage = new HelloMessage(rlpList);
        helloMessage.parseRLP();
        System.out.println(helloMessage);

        assertEquals(11, helloMessage.getProtocolVersion());
        assertEquals(0, helloMessage.getNetworkId());
        assertEquals("Ethereum(++)/v0.4.3/ETH_BUILD_TYPE/ETH_BUILD_PLATFORM", helloMessage.getClientId());
        assertEquals(7, helloMessage.getCapabilities());
        assertEquals(30303, helloMessage.getPeerPort());
        assertEquals(
                "E02B18FBA6B887FB9258469C3AF8E445CC9AE2B5386CAC5F60C4170F822086224E3876555C745A7EC8AC181C7F9701776D94A779604EA12651DE5F4A748D29E1",
                Hex.toHexString(helloMessage.getPeerId()).toUpperCase() );
    }

    /* DISCONNECT_MESSAGE */

    @Test /* DisconnectMessage 1 */
    public void test_3() {

        String disconnectMessageRaw = "C20100";
        byte[] payload = Hex.decode(disconnectMessageRaw);
        RLPList rlpList = RLP.decode2(payload);

        DisconnectMessage disconnectMessage = new DisconnectMessage(rlpList);
        System.out.println(disconnectMessage);

        assertEquals(disconnectMessage.getReason(), ReasonCode.DISCONNECT_REQUESTED);
    }

    @Test /* DisconnectMessage 2 */
    public void test_4() {

        String disconnectMessageRaw = "C20101";
        byte[] payload = Hex.decode(disconnectMessageRaw);
        RLPList rlpList = RLP.decode2(payload);

        DisconnectMessage disconnectMessage = new DisconnectMessage(rlpList);
        System.out.println(disconnectMessage);

        assertEquals(disconnectMessage.getReason(), ReasonCode.TCP_ERROR);
    }

    /* PEERS */

    @Test /*  PeersMessage 1*/
    public void test_5() {

        String peersMessageRaw = "F89911F84A84364845B482765FB840430BB21ECF73A54AEF511404948C016532406B371EDABD20A478C3ECD22052A0065A7399A6D19594E24B153930E63A3B12B3BA4F30A3CDA1977D60D4060FFF25F84A845163E11282765FB8405F1DBE5E50E92A6B67377E079D986155C0D82D964E65332F524810ED7831A52837F1C0FB042EA2A25548E3B444C337F54C7547B2D877734E2899F40BFA23ED51";
        byte[] payload = Hex.decode(peersMessageRaw);
        RLPList rlpList = RLP.decode2(payload);

        PeersMessage peersMessage= new PeersMessage(rlpList);
        System.out.println(peersMessage);

        assertEquals(2, peersMessage.getPeers().size());

        PeerData peerData = peersMessage.getPeers().get(1);

        assertEquals("/81.99.225.18", peerData.getInetAddress().toString());
        assertEquals(30303, peerData.getPort());
        assertEquals("5F1DBE5E50E92A6B67377E079D986155C0D82D964E65332F524810ED7831A52837F1C0FB042EA2A25548E3B444C337F54C7547B2D877734E2899F40BFA23ED51",
        		Hex.toHexString( peerData.getPeerId() ).toUpperCase());
    }


    @Test /* Peers msg parsing performance*/
    public void test_7() throws UnknownHostException {

        long time1 = System.currentTimeMillis();
        for (int i = 0; i < 20000; ++i) {

            String peersPacketRaw = "F89911F84A84364845B482765FB840430BB21ECF73A54AEF511404948C016532406B371EDABD20A478C3ECD22052A0065A7399A6D19594E24B153930E63A3B12B3BA4F30A3CDA1977D60D4060FFF25F84A845163E11282765FB8405F1DBE5E50E92A6B67377E079D986155C0D82D964E65332F524810ED7831A52837F1C0FB042EA2A25548E3B444C337F54C7547B2D877734E2899F40BFA23ED51";

            byte[] payload = Hex.decode(peersPacketRaw);
            RLPList rlpList = RLP.decode2(payload);

            PeersMessage peersMessage = new PeersMessage(rlpList);
            peersMessage.parseRLP();
        }
        long time2 = System.currentTimeMillis();

        System.out.println("20,000 PEERS packets parsing: " + (time2 - time1) + "(msec)");
    }

    /* TRANSACTIONS */
    
    @Test  /* Transactions message 1 */
    public void test_8() {

        String txsPacketRaw = "f86e12f86b04648609184e72a00094cd2a3d9f938e13cd947ec05abc7fe734df8dd826"
        		+ "881bc16d674ec80000801ba05c89ebf2b77eeab88251e553f6f9d53badc1d800"
        		+ "bbac02d830801c2aa94a4c9fa00b7907532b1f29c79942b75fff98822293bf5f"
        		+ "daa3653a8d9f424c6a3265f06c";
        
        byte[] payload = Hex.decode(txsPacketRaw);
        RLPList rlpList = RLP.decode2(payload);

        TransactionsMessage transactionsMessage = new TransactionsMessage(rlpList);
        System.out.println(transactionsMessage);

        assertEquals(1, transactionsMessage.getTransactions().size());

		Transaction tx = transactionsMessage.getTransactions().get(0);

		assertEquals("5d2aee0490a9228024158433d650335116b4af5a30b8abb10e9b7f9f7e090fd8", Hex.toHexString(tx.getHash()));
		assertEquals("04", Hex.toHexString(tx.getNonce()));
		assertEquals("1bc16d674ec80000", Hex.toHexString(tx.getValue()));
		assertEquals("cd2a3d9f938e13cd947ec05abc7fe734df8dd826", Hex.toHexString(tx.getReceiveAddress()));
		assertEquals("64", Hex.toHexString(tx.getGasPrice()));
		assertEquals("09184e72a000", Hex.toHexString(tx.getGasLimit()));
		assertEquals("null", ByteUtil.toHexString(tx.getData()));

		assertEquals("1b", Hex.toHexString(new byte[] { tx.getSignature().v }));
		assertEquals("5c89ebf2b77eeab88251e553f6f9d53badc1d800bbac02d830801c2aa94a4c9f", Hex.toHexString(tx.getSignature().r.toByteArray()));
		assertEquals("0b7907532b1f29c79942b75fff98822293bf5fdaa3653a8d9f424c6a3265f06c", Hex.toHexString(tx.getSignature().s.toByteArray()));
    }
    
    @Test  /* Transactions message 2 */
    public void test_9() {

        String txsPacketRaw = "f9025012f89d8080940000000000000000000000000000000000000000860918"
                            + "4e72a000822710b3606956330c0d630000003359366000530a0d630000003359"
                            + "602060005301356000533557604060005301600054630000000c588433606957"
                            + "1ca07f6eb94576346488c6253197bde6a7e59ddc36f2773672c849402aa9c402"
                            + "c3c4a06d254e662bf7450dd8d835160cbb053463fed0b53f2cdd7f3ea8731919"
                            + "c8e8ccf901050180940000000000000000000000000000000000000000860918"
                            + "4e72a000822710b85336630000002e59606956330c0d63000000155933ff3356"
                            + "0d63000000275960003356576000335700630000005358600035560d63000000"
                            + "3a590033560d63000000485960003356573360003557600035335700b84a7f4e"
                            + "616d655265670000000000000000000000000000000000000000000000000030"
                            + "57307f4e616d6552656700000000000000000000000000000000000000000000"
                            + "00000057336069571ba04af15a0ec494aeac5b243c8a2690833faa74c0f73db1"
                            + "f439d521c49c381513e9a05802e64939be5a1f9d4d614038fbd5479538c48795"
                            + "614ef9c551477ecbdb49d2f8a6028094ccdeac59d35627b7de09332e819d5159"
                            + "e7bb72508609184e72a000822710b84000000000000000000000000000000000"
                            + "000000000000000000000000000000000000000000000000000000002d0aceee"
                            + "7e5ab874e22ccf8d1a649f59106d74e81ba0d05887574456c6de8f7a0d172342"
                            + "c2cbdd4cf7afe15d9dbb8b75b748ba6791c9a01e87172a861f6c37b5a9e3a5d0"
                            + "d7393152a7fbe41530e5bb8ac8f35433e5931b";

        byte[] payload = Hex.decode(txsPacketRaw);
        RLPList rlpList = RLP.decode2(payload);

        TransactionsMessage transactionsMessage = new TransactionsMessage(rlpList);
        System.out.println(transactionsMessage);

        assertEquals(3, transactionsMessage.getTransactions().size());

        Transaction tx =
                transactionsMessage.getTransactions().get(0);

        assertEquals("1b9d9456293cbcbc2f28a0fdc67028128ea571b033fb0e21d0ee00bcd6167e5d",
        		Hex.toHexString( tx.getHash() ));

        assertEquals("00",
        		Hex.toHexString( tx.getNonce() ));

        assertEquals("2710",
        		Hex.toHexString( tx.getValue() ));

        assertEquals("09184e72a000",
        		Hex.toHexString( tx.getReceiveAddress() ));

        assertNull( tx.getGasPrice() );

        assertEquals("0000000000000000000000000000000000000000",
        		Hex.toHexString( tx.getGasLimit() ));

        assertEquals("606956330c0d630000003359366000530a0d630000003359602060005301356000533557604060005301600054630000000c58",
        		Hex.toHexString( tx.getData() ));

        assertEquals("33",
        		Hex.toHexString( new byte[] {tx.getSignature().v} ));

        assertEquals("1c",
        		Hex.toHexString( tx.getSignature().r.toByteArray() ));

        assertEquals("7f6eb94576346488c6253197bde6a7e59ddc36f2773672c849402aa9c402c3c4",
        		Hex.toHexString( tx.getSignature().s.toByteArray() ));

        tx = transactionsMessage.getTransactions().get(2);

        assertEquals("dde9543921850f41ca88e5401322cd7651c78a1e4deebd5ee385af8ac343f0ad",
        		Hex.toHexString( tx.getHash() ));

        assertEquals("02",
        		Hex.toHexString( tx.getNonce() ));

        assertEquals("2710",
        		Hex.toHexString( tx.getValue() ));

        assertEquals("09184e72a000",
        		Hex.toHexString( tx.getReceiveAddress() ));

        assertNull(tx.getGasPrice() );

        assertEquals("ccdeac59d35627b7de09332e819d5159e7bb7250",
        		Hex.toHexString( tx.getGasLimit() ));

        assertEquals("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000002d0aceee7e5ab874e22ccf8d1a649f59106d74e8",
        		Hex.toHexString( tx.getData() ));

        assertEquals("1b",
        		Hex.toHexString( new byte[] {tx.getSignature().v} ));

        assertEquals("00d05887574456c6de8f7a0d172342c2cbdd4cf7afe15d9dbb8b75b748ba6791c9",
        		Hex.toHexString( tx.getSignature().r.toByteArray() ));

        assertEquals("1e87172a861f6c37b5a9e3a5d0d7393152a7fbe41530e5bb8ac8f35433e5931b",
                Hex.toHexString(tx.getSignature().s.toByteArray()));
    }

    /* BLOCKS */

    @Test /* BlocksMessage really big message parsing */
    public void test11() {

        String blocksRaw = "F9172113F8B7F8B3A04E3D098FA663C27A4C724002B12B608BD636632AA17899FF6782E2E9210F4021A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A078701082D9264A31CE3AA5A12AE068709301E9F5484E853139C81D86D5959C5980835772648202A08609184E72A0008307E8F380845398D52380A03EBAE36D8FEB6DF78401117DCFE38742DF6C84EF708F20BA2341042D7BD4D40FC0C0F8B7F8B3A0A9128CE3659938930C15C22D1ADE22964EFDF4054AD6819AD8FDA2C64A0141E7A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0E5BF6A4707617B4B906DADF85F9CE2FF58222C2F89C3F29F4FEDF9E2661A00208083575C8D82029F8609184E72A0008307EAEE80845398D51A80A0BD54850235E3138F7433B66B675368C3435D53D03DEEB277078C7A425C85516DC0C0F8B7F8B3A012EC9C0863764E5A2BB88EE8B3685367CE87857329535077E34BE3C3D6502695A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A08AC24C4D4F63A4F72A5D1097F7756CC39B16574BEAACFEA82744D11FBCC075D480835746BC82029E8609184E72A0008307ECEA80845398D50080A07ECD1836FD89BC993DBC8D116FD2263F0469CEB9FBC4BBC0CA3EEC5B4CD05DC7C0C0F8B7F8B3A02FA1B8736311382AE02F669163FE53C31F3A4C98846E6DDF8738D9D4CAA05883A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A054B1EB45E47AB8D46BBA2F067AFBF7B741F5E2E3377F625522EC2D693C18313580835730F082029D8609184E72A0008307EEE680845398D4FF80A0CD6B835378456E4DF2EDE6B30DBC7A941ECF07733517BA1FF7E284344227A9C1C0C0F8B7F8B3A0DE20EAE9ED09A0A81A901CBE4B1E095AAB685E86F4501277754827E025BA173DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0B8E5D0E8F943575CEEEFEB7CC7E17D77F8CC61CBEC7662336A95BAC330078F3E8083571B2A82029C8609184E72A0008307F0E380845398D4F580A09E9003B8A22F7F2F1C6E516700AD859A855873CE3B147E8653D6B48706C38C0BC0C0F8B7F8B3A07FC1BB6E1B8F39FDA59F136622D8B9BE14FBD01D5382FAD30F0BCA78CB78B405A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0A768B954A8BA931141E9436D74931CE02A0C3B9D54577DFADFF6467307EED162808357056982029B8609184E72A0008307F2E080845398D4F480A0C4587BBBCFA6235FCFE312BC6438936A073BD6C706D16C934034673251253C2BC0C0F8B7F8B3A09F4C296D1889239CB9E79DF78F353E37CD21354B2ED8820C99A9D2D8B9072E92A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A02ED165D7907227FC7897A2D359DECFDC4C1DA9E82D0826BBE58C5C26729E49E4808356EFAE82029A8609184E72A0008307F4DE80845398D4F180A07C19008D4830C03317B2BBEFCA9A32CD305E396619CADB67CDB398B8D0FA6643C0C0F8B7F8B3A0E18DA2225758ED3E1125AAC2B58E5F86DECEC03D0B15FA81B3A8C469DD805BF4A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A02EBCA109398FB48DA8B0BBE75E718E87447C9A6FB50C6CDA1B3899662CDF0F67808356D9F88202998609184E72A0008307F6DC80845398D4E580A0163222F3F38C75EA943760A7FEF66948E4B018C986AF96C09CA629A6C587DB6CC0C0F8B7F8B3A0BA9DB82A9848C8D21689C1C4E219A35C85FB6A7B2930A47C87C51874197B6494A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0C4CB2A304EFE58AA2E9C2752CBEC1917ED4CC235AD1A375A835E4A8D58C2E109808356C4478202988609184E72A0008307F8DB80845398D4E280A00029A05C9C96314DDBEB94DB93008BFBEC7AC8E8A2FFDA012A80CEBFE155EB33C0C0F8B7F8B3A0BB6408C4A9612A2B8D81545B03A01DEC0689750BAA77E352512AF8411A1EF07BA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0476883DE3ED8B49D0D3BDAF866331E43765B4F1C253F86ED3225BC78EA84AA58808356AE9C8202978609184E72A0008307FADA80845398D4DD80A0A6D67E30C292734082BE0E1D70BF891159A7E6C6D5293A74237E7A8C948D0D07C0C0F8B7F8B3A0B8C4CBDE5BDA2E5E306B97492AAFFCCEE1EBE4B5020724C090B0AF21AA9C072EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0E66299FB9CD4A01D7A3A27575F4775FF8F930B78CB88B54C29E6D65E07ED7C1080835698F68202968609184E72A0008307FCDA80845398D4DC80A0CE9070210C9AFD82E70235BC067BEB2636DE3AE9C17D22D523E9545378B117F0C0C0F8B7F8B3A05CD679EB058797DE4FC2BF4072AC187B7CCB3D173880685A71382647A7ECE5CCA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0314424865F4BB387E8FAC486BF543C28CAF9B7558A8E7B9A704946D5579C0FD380835683568202958609184E72A0008307FEDA80845398D4D880A0221E7C37257E0589BE33B252C34AADBCFC17F225497101E272DC0E7A0264D4FFC0C0F8B7F8B3A073F063D35A56F2AEEE30FBB1126DA5AF83137C9ABBD86B79D62E3CE9CEA77CA6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0579018D81D7A75BF7B09C8836B9628E24D854E68B6A0FA0907AC45854CB1A6618083566DBB8202948609184E72A000830800DB80845398D4D780A094C474744089C5D54AEAC3F0F35C024528072F6BF99A5092C76DBE0C0E174E51C0C0F8B7F8B3A07BFBCB0019132035D7EFE1428D15EB641161BB7F73079B6789AF1F3412C0DF6FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0C8466D2B79D70C04C9DF51E852C133FB226C7FFFE19C1F487DE4464ACB34F1E080835658258202938609184E72A000830802DC80845398D4D280A0DB3DCFD66D01831115D191321847794B1A99AB0CF2EADA6418BC0E9B86B975D6C0C0F8B7F8B3A04EF151FA9C33959B4ED270A53E0BFA93EBCA8A4F8D19AC700BC56B5840986A5CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0147C812F39499C3E9BE1549DD3829A1EF987F2112FF4455E98CFA4859443DEC680835642958202928609184E72A000830804DE80845398D4D080A0B40DD56DCB97FA44BADD2DF65B86E9BFDDA10BE1E58BE54161BBC27B0A4BFB7DC0C0F8B7F8B3A0289E7F0047FB304BC3C9412B658912A51C8399BDBFA68051B6AC2107C267813EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A07248446C3A49C4170173AF1ED87A5F1C8A988F2BDD1CA54AF0529227C056FC088083562D0A8202918609184E72A000830806E080845398D4CF80A0A0AFBDB920883BC89724E90404425ADC2547A233151E75A924FCA74FEDED0695C0C0F8B7F8B3A0815BF53656BD7BCA2B0150696D9CF7F7EB423BC837F51D5D47B20604206984ECA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347941408C012810FDC21F9EFB5DC3A4553E7795D1007A0673842E45E540833666089984E04A5918B9B83FC501A4534E2545F93BA8EA6D380835617858202908609184E72A000830808E380845398D4C380A021FB11A6283D9F1E3E62ADD73C1CB7A3858E826DC4781A8FFDAB2BF0FE6FA27BC0C0F8B7F8B3A0DFD439BD77F248133218FE7D6FD5C025FF90C62756AB12680F57E71A0145313FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0EC92BB4E2D01FFF0D7A3476D1902409D1876EDECD4D4D7997E901AA88D1B454C8083562D1082028F8609184E72A00083080AE680845398D3FE80A0FD745B9AC481F76C27772CA8780E567B7EE3F61726079AE3F9B7E52C5A6625C9C0C0F8B7F8B3A016380C1C0BCD6E4E2639BF71A88C5ED62989DC050A57723208FE7B16F9692E3CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794E559DE5527492BCB42EC68D07DF0742A98EC3F1EA0EBEF7B51621F344969C98B12162DA5561CCF1379B25A97D1EF060E9CBA6BC1A580835642A082028E8609184E72A00083080CEA80845398D3BA80A039E3ABFD43CD4C0BF449AE227FC00E575D3D9E41184C6FB8F904BFC1B2F84EEDC0C0F8B7F8B3A005D574A8528490A334A41FDBFBE30496BB157698B07CB5F50C5500B074B65FCBA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A09A9655501B4139756A1049E6BAC7C54C075911E7CE5864C96EF84B3B50547C188083562D1582028D8609184E72A00083080EEE80845398D3AA80A0095EA23CE2F7681E745B222BC0CADF0595F83540F5F5E16A5CA1B0270A4D3976C0C0F8B7F8B3A01CA5D4F780DC08D5D288B2DBDA84A8331821A3AE83FA1A05B2C41ED1901BFC4AA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A09B83C231F21075F7F6C5730AE6F641589D8C8FB0A6BB50C59BA0D54F4112FFC9808356179082028C8609184E72A000830810F380845398D3A180A029E9AE6CAC4CDF2E4F4EBD304821C0D71438EEA4249C137E07C8E5526A59C8FBC0C0F8B7F8B3A0FD542F20E15059A6EE14626D13376FD062B7FA976790919B9DE3BFC5FF64ABFCA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0018F22DC9381175980D9339FA9EEDCC4908090EE67930B1CA12DCB095EF2A4428083562D1B82028B8609184E72A000830812F880845398D36C80A08822E8886215F90D24AF961E699F49F43EA79CF1B719E68C3260011D98E6D1DCC0C0F8B7F8B3A0BA04C05D4640D6FC157BF56D60CF4E6DF49CC4F605F2FBDACC9E3041E2E66427A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794E559DE5527492BCB42EC68D07DF0742A98EC3F1EA031EC126502CF877C096F7E23F8590A0274E66DC435068448E408536C8501089E808356179682028A8609184E72A000830814FE80845398D34780A0F1F9910D75D3EE7CB0AB0B5CB04E32F05960CFF697BF0C3319964E30EC284B31C0C0F8B7F8B3A038700E2D2033293540CA5E0D762A16B98CF9AE64D5081F8E67D944E9BE6605A9A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0966E5E6BA73F423A1BEB270113C3CB5DCC448849C988F4CBE434BF91A6C28AF88083562D218202898609184E72A0008308170480845398D2B180A0683AFE10542DF70388960C25824CD602218125C2356B708725949333629FE2F4C0C0F8B7F8B3A0E59FB5ABDEDB01506208DFADA6B6050D00332BC43620E15894E58F9D90E4868DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0751F572D0F19E6D3A8E11BCA14CB54345D391D2A5934D5528AC863CFDCC5873780835642B18202888609184E72A0008308190B80845398D1DD80A0207A6B27D7CF7498073477105A90C02F4D9F8D183E780970148AB550B66FFE99C0C0F8B7F8B3A014CF3EA209980B17DA3CF6002AC192B63EFF02BCBFC62F790493A7BB9E374D72A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A053E1E3C782586C5A104DBFEC03FF64E433A3CAFBCB65DC69DC30FA12C70B63F38083562D268202878609184E72A00083081B1280845398D1C580A07AF2FBE29DCDB8E6DA26149A8B5FC181A94C89A1D60BD6AB4FAB767F419A8391C0C0F8B7F8B3A0A831B5DACE1E49762B0894E6EF1BBB1DF946C3560D811C6CCBEF8B6A7AEBB3EDA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0F83F501E76C7863E5857885E46DFC74E5B0452AF51B17A80AF753C228AA5EF2F80835617A18202868609184E72A00083081D1A80845398D1C180A0C43332D79FC12856D6321E7BE391A0344C76A2765B9ED364DDEC1822524176D1C0C0F8B7F8B3A0B6F55A42F40528266C17FCE2FEEF2BF7DE8763F93522C416526E756659AE1B98A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0A89948D82DDC0417B2714EC1D4096EBE38F711E4C68AD1C939189514B04E31678083562D2C8202858609184E72A00083081F2280845398D0FB80A07ED5B4E3E7BBC9EADED38B3E65A5F0EE898A82837C36C0B5BE7EB3C3962AD267C0C0F8B7F8B3A06F7A64C21AB4F5C937FA5532888A0173D2DB047DEF600D3F36E55FAC7F0E8DFCA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A0F51FD229641E356383E7716CF0FB2907FDA5B83FD014BEAFD13A7BF35066930F80835617A78202848609184E72A0008308212B80845398D0FB80A04C7385E447F646750A6FBC0BD50C9F88AC41D22ED9FB3CA49F47461362469625C0C0F8B7F8B3A08721A2E0A2AB5155325F3A19A5DBE2D97AC67D111C43EA90A94F407D1E5DC6F5A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794E559DE5527492BCB42EC68D07DF0742A98EC3F1EA07C45068F0F5A4BCC88246A32E1AA7E95E5CF02786C7FD64586B73CC2B931D06D8083562D328202838609184E72A0008308233480845398D0C180A02EC24970AB7B0E17D5D73FCE074577867321F278745E1C062257ECBDB3F51027C0C0F8B7F8B3A057A2795196F8007A34551BF356037C09C2E96B49E9611F5E308A1C9EE46147B2A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794826E9B89245FA9AD982CEDB2F85BD23494142F73A017E625F9681424401E637A37ED53FDA6A9B8F713379F3664EB26E597F2281C5780835617AD8202828609184E72A0008308253E80845398D0B680A0D61174BD762DBE2511BFC618F0C07E8480B85ADAF49434D54D9831570B2C6141C0C0F8B7F8B3A0D076D1EC43FD2E345D7B31C59D37208F0D5E93B5FC28929BE16246E63A6933EEA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794E559DE5527492BCB42EC68D07DF0742A98EC3F1EA001C1634EB128E49ECE80896DFBDC643303AA1878FD62062AC56431E5760F3949808356022D8202818609184E72A0008308274880845398D0AD80A03BD88E5D095D1F9AA8D11A7E9503768C13EC7D82FB23A11C8F03DB5EB3B16424C0C0";

        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = RLP.decode2(payload);

        BlocksMessage blocksMessage = new BlocksMessage(rlpList);
        List<Block> list = blocksMessage.getBlockDataList();
        System.out.println(blocksMessage);

        assertEquals(32, list.size());

        Block block = list.get(31);

        assertEquals("57A2795196F8007A34551BF356037C09C2E96B49E9611F5E308A1C9EE46147B2",
        		Hex.toHexString(block.getHash()).toUpperCase());

        assertEquals("D076D1EC43FD2E345D7B31C59D37208F0D5E93B5FC28929BE16246E63A6933EE",
        		Hex.toHexString(block.getParentHash()).toUpperCase());

        assertEquals("1DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D49347",
        		Hex.toHexString(block.getUnclesHash()).toUpperCase());

        assertEquals("E559DE5527492BCB42EC68D07DF0742A98EC3F1E",
        		Hex.toHexString(block.getCoinbase()).toUpperCase());

        assertEquals("01C1634EB128E49ECE80896DFBDC643303AA1878FD62062AC56431E5760F3949",
        		Hex.toHexString(block.getStateRoot()).toUpperCase());

        assertEquals("56022D", Hex.toHexString(block.getDifficulty()).toUpperCase());
        assertEquals(1402523821, block.getTimestamp());

        assertNull(block.getExtraData());

        assertEquals("3BD88E5D095D1F9AA8D11A7E9503768C13EC7D82FB23A11C8F03DB5EB3B16424",
        		Hex.toHexString(block.getNonce()).toUpperCase());

        System.out.println(blocksMessage);
    }

    /* GET_CHAIN */

    @Test /* GET_CHAIN message parsing*/
    public void test_12() {

        String getChainRaw = "F9042414A09F7A910147A6C99AB7EEEAC1ADC7B1B9B0D7D9DD83FD7FC125561016F19B624DA024B519ED5F71207330C1F450B7A4C7445C589B5F9AE73E9BBA09E0A8CB15D845A01EF7B03C7E58E65068D71F68E168C0CC0438808C32FB3E46E402D078B2020E0DA06A0F152620F606E134679D22A86156F9DDEB56FACD62C3106CC66AE030234483A001A3E918F9C2F74BD144505CF70650EF30BE806C533BA5AE3C983F55615EE98EA0E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138A0C55035BC5BDA25A8C6A2EFF4CCF5386CFFF3E7EE1DC9168B00AABF1074FEB1E2A060AC4D0C12C4CBF552440E659FE4E54C38EF7D05EF98965BA0E0248379CB78DFA0E1620BF60A735DDEA7CB434143E7EF663D043420F017360289FF78046948A77AA0DA8BC25F6571AB0EDE9C3DEF34FFF996575ADFCC1F8009A0388CE0A63AD9FC57A0E153CD998421E4F6BAC6A8329AE90BDA70D5D0F46A7EC02B88BDF5D3CAA8384FA0D3F00977D766A5CAF8F07EF8D15B1DADBBFD57B60BBE6CA54B2F9C2446F614EFA08687EC7AE1A541B13CDA57DCF387DEA3EA35A35AC3D5A9381376EAFBC7BA2CF5A08814AC8660E776A3FCA432D2E9A3533AFFEAEC783ECBB5DAD495B44E04EF1F98A07F2E67F508830BF18E8A432BAB9B957FA2BCDE57BE6C766C13871F833C27B9A5A021EE1E6602530EF711F6C8022799108E1AFB546E7B5FF3E3CBB4DA66C054868DA02940A17DD5C1D1911FFDA7DFAE3E5FAF8E1808CBD11F3248C18B8777B4A5D256A07E5D2F25D9750665ADBFF9C36820AD67CC55850D7D798DAB512343AB0C4E58B3A06674BD13B1051852413031BAA885448E50917D7F1D5EFB7DBA397ED4E5C36D72A06AA7A7D18B07BE0222DA47A8EE6923BAD522DBF5D0650D64CA0F2AD4C606D0CCA07F877735FCC29F804926AACEDBF7AD4896E330DCCE57F257A7D5C81F5CC03188A0FF6B7749526281A5E6A845B8ACC7DC03D2CAAEAFF0CEBF78659FDE1007AD9C05A054D6375CF54B0246FB45787206BA70115DED577354942A9219BC9E761A7E0CBCA0809384946576FB15A8F827B30045D18203A90BE662863D5F205B868DF882472AA05A6EA58D02A2823BA693AC11C21D3C4D66AFFFDB9F1475EA86A461912C2F3187A003AF21F3939C29C231200B1F790F16421A8923254CBF2A90455B9B8F28BE4562A036FDFB3E05936CAA1ABBDCFBBACD9000F86FBCAE2228E77346533CEF17073767A0D3CE8B71E129020F3356A09946F9BC4C18E61D9516E74F6F912461A438F1E006A01D8203A8E23F50D70188ED3099E50645B92959C2216EA7A74719C159B4978BDBA03812A8FC4A5BB6EF0832EBF5058FAF65A46187CEE568C94915AE1850069775F3A0687DDEF8750F606637B3F5F23D286053671081A1AD224B35A624DE7392193951A0E6A8E1D4417292E20F9698A3464CEEABC6476A57521FF79D994DE22C55DADEAD820100";

        byte[] payload = Hex.decode(getChainRaw);
        RLPList rlpList = RLP.decode2(payload);

        GetChainMessage getChainMessage = new GetChainMessage(rlpList);
        getChainMessage.parseRLP();
        System.out.println(getChainMessage);

        assertEquals(32, getChainMessage.getBlockHashList().size());

        assertEquals("E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138",
        		Hex.toHexString( getChainMessage.getBlockHashList().get(5) ).toUpperCase());

        assertEquals("6AA7A7D18B07BE0222DA47A8EE6923BAD522DBF5D0650D64CA0F2AD4C606D0CC",
        		Hex.toHexString( getChainMessage.getBlockHashList().get(19) ).toUpperCase());

        assertEquals("03AF21F3939C29C231200B1F790F16421A8923254CBF2A90455B9B8F28BE4562",
        		Hex.toHexString( getChainMessage.getBlockHashList().get(25) ).toUpperCase());
    }

    /* NOT_IN_CHAIN */

    @Test /* NotInChainMessage parsing 1 */
    public void test_13() {

        String getChainRaw = "E015A0E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138";

        byte[] payload = Hex.decode(getChainRaw);
        RLPList rlpList = RLP.decode2(payload);

        NotInChainMessage notInChainMessage = new NotInChainMessage(rlpList);
        System.out.println(notInChainMessage);

        assertEquals("E5E441F0877116011CCDECE2501A50B40C40418377037E16D0282B2B5E347138",
        		Hex.toHexString(notInChainMessage.getHash()).toUpperCase());
    }

    @Test /* BlocksMessage POC-5 real msg*/
    public void test12() {

        String blocksRaw = "F8D813F8D5F8D1A0085F6A51A63D1FBA43D6E5FE166A47BED64A8B93A99012537D50F3279D4CEA52A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794D8758B101609A9F2A881A017BA86CBE6B7F0581DA068472689EA736CFC6B18FCAE9BA7454BADF9C65333A0317DFEFAE1D4AFFF6F90A000000000000000000000000000000000000000000000000000000000000000008401EDF1A18222778609184E72A0008080845373B0B180A0000000000000000000000000000000000000000000000000D1C0D8BC6D744943C0C0";

        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = RLP.decode2(payload);

        BlocksMessage blocksMessage = new BlocksMessage(rlpList);
        List<Block> list = blocksMessage.getBlockDataList();
        System.out.println(blocksMessage);

        Block block = list.get(0);
    }

    @Test /* BlocksMessage POC-5 real big msg*/
    public void test13() {

        String blocksRaw = "F91BB313F8D5F8D1A0241A2A72372AD63C40704C93CD380A51FEE174EB59501D731A009F51372E5205A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0DA5AB2C34F600525393C29D492AE1ED9140919DDB53E9498F2DEE502CF587EC9A000000000000000000000000000000000000000000000000000000000000000008341C5E1208609184E72A000830EC9F48084536AD0E180A0000000000000000000000000000000000000000000000000D441E9FE9406E474C0C0F8D5F8D1A0E963653D860F35E27A5572CFEECE1BB518C42BB97DEAC0978FA788F6DCB45CF7A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0501FE35864E5FE87049925663356E746D89B7341EAB64DF182B38590EE792B5FA000000000000000000000000000000000000000000000000000000000000000008341B5741F8609184E72A000830ECDA88084536AD0DA80A00000000000000000000000000000000000000000000000007828A9BAAB6A7ECFC0C0F8D5F8D1A003D0110B5137559C8A7F5776C4AB2FD7556E972B2398802E9284B0E530C4E836A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0D6237F3F6440A41F87C210428913C9D382ADCE25934CBB78C8D2E8309EE0F954A000000000000000000000000000000000000000000000000000000000000000008341A50B1E8609184E72A000830ED15D8084536AD0CB80A00000000000000000000000000000000000000000000000001EFCD54BEDDF3380C0C0F8D5F8D1A0B2F12064C028E457DF19DBDEA79DBC02477E1BD2C9B9E44A7260B89E24EEB672A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA09622DCD321E343D62708AF4D0F02C06F0424FAAA615B06CC561BA4BD6B9A9059A00000000000000000000000000000000000000000000000000000000000000000834194A61D8609184E72A000830ED5138084536AD0C980A0000000000000000000000000000000000000000000000000B5438A51AD0D626EC0C0F8D5F8D1A088740C3D1B992EE40221C8099E503543669C0DB48317B48C746A133F9C3D22B7A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA01CE096A03FB4F29111158043646FAC7FBD1CA29253DF2A9B64DAAD41E00D8D93A00000000000000000000000000000000000000000000000000000000000000000834184451C8609184E72A000830ED8CA8084536AD0C880A0000000000000000000000000000000000000000000000000B617267976C0ED9DC0C0F8D5F8D1A0BD600487C95AE3BF9923188C7E86260EFD21758E452A42EDD4E62F75F7599A0BA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA05E7419539879A254A59E4E8054C230C19EE588DC6E7D1D9398486AF01C522CF0A00000000000000000000000000000000000000000000000000000000000000000834173E91B8609184E72A000830EDC828084536AD0B580A0000000000000000000000000000000000000000000000000224668B25482A4FDC0C0F8D5F8D1A06CF575AE2D8D4E636BDB05D27F14E91FFBADE677F23068EDA5AFB1DDCF387838A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA05EA0F8C08233E9A867BA5989EE74ED825AB0FF3C52EE0BCA2297D71A52DF6F13A00000000000000000000000000000000000000000000000000000000000000000834163911A8609184E72A000830EE03B8084536AD0AA80A000000000000000000000000000000000000000000000000015FA4CACFA1CE96CC0C0F8D5F8D1A021745CD12304E2B55FCE61E49B929BC4D0DA9B7C989D5E789AD6373E8CA4DFA1A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0D1546B182CFA9776D91695400B0AE4BE474A051F964D886CC761B1476BC52747A000000000000000000000000000000000000000000000000000000000000000008341533D198609184E72A000830EE3F48084536AD0A680A0000000000000000000000000000000000000000000000000910666C71F0C6015C0C0F8D5F8D1A0B94798F50873CCE252A237BC347879E96CB95CB89E8C2FF1CEAA4FC20671D7A1A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0B28C842A75C674D7FECE960B3CC7E48319262D393647C1E37EAB1B7A738AC7F5A00000000000000000000000000000000000000000000000000000000000000000834142ED188609184E72A000830EE7AE8084536AD0A680A000000000000000000000000000000000000000000000000098993C3F1D7DD302C0C0F8D5F8D1A0E9F0C11A4DADEAA7DA131639CC78A65897568A178020BFF71C0A895A62B94126A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0473283BCF366E648963BFC15C006D92D2F73FD8B8A9A5CF0715A306102AF0471A00000000000000000000000000000000000000000000000000000000000000000834132A1178609184E72A000830EEB698084536AD0A280A0000000000000000000000000000000000000000000000000EF3D442D4F180BE8C0C0F8D5F8D1A052D3DEF715BE4DCC7BF26774CF2F46220E1E6139428190D99386B50478A328E6A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0874BF4FB3B5433222701895A14E5FDE926DAA419ABE5BFEDF41DD53D9C3B7716A0000000000000000000000000000000000000000000000000000000000000000083412259168609184E72A000830EEF258084536AD0A080A0000000000000000000000000000000000000000000000000AC63BB35461C7E23C0C0F8D5F8D1A09DF048629BD8AC4740FA437AD0BDA26D92853C2483B6E0DA8ED790C5E068EDA1A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA018B3624F1E0CE3D46CCAB5AA5C9CE16E91740704C81CD342F712F9A3B6B14B72A0000000000000000000000000000000000000000000000000000000000000000083411215158609184E72A000830EF2E28084536AD07880A0000000000000000000000000000000000000000000000000E1E40B4CCB7A7650C0C0F8D5F8D1A09D9DE4728A55A7A26CF9B2942235CD10E89443B71A63C4C2CD68016106228BF5A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA08C4405BF700474CB2081DCDC433DD68E0BAEB6376278EF9F31C51B8AD729D584A00000000000000000000000000000000000000000000000000000000000000000834101D5148609184E72A000830EF6A08084536AD06580A00000000000000000000000000000000000000000000000007530D22D42044BAEC0C0F8D5F8D1A09B2D93A9228E373687E106B8B3F33007F18D3AD098784FBB710AFC86A483D99AA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0F1EA4E93A025A5BFF907CBE330F961593A00E79692423B411DCC449AC9DBD3C9A000000000000000000000000000000000000000000000000000000000000000008340F199138609184E72A000830EFA5F8084536AD04480A0000000000000000000000000000000000000000000000000C1072BD480F8546CC0C0F8D5F8D1A0AD8F6F3AED4784805B4B18E1EEF971BE8E196C7245B0717B8065CEA7E6CC7E02A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0BF1CB953D6541CB7FCF49552C2C96767F76A62A117E41E572F21BC9FDBA8EC16A000000000000000000000000000000000000000000000000000000000000000008340E161128609184E72A000830EFE1F8084536AD04180A00000000000000000000000000000000000000000000000009D15DE72AD78E877C0C0F8D5F8D1A01CBFAE447EF444E8BE711C7DF471FFEDBB7E3317175BD25F5AF2A65342E2B373A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA010F6479D5F790546140EFCA7675DD2256ABFECC0A86AD551BCDBE59FD9475AF3A000000000000000000000000000000000000000000000000000000000000000008340D12D118609184E72A000830F01E08084536AD03080A00000000000000000000000000000000000000000000000007E01A25F73936D1DC0C0F8D5F8D1A027E9B34ACA511576C05DEB919053C1EEA958FF532FEEA1F952BAE699E40FB5D2A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0ADDE0B5F2471D97EC743253952910B8C7F56F413F4564049077ECD93BB298E61A000000000000000000000000000000000000000000000000000000000000000008340C0FD108609184E72A000830F05A28084536AD02D80A00000000000000000000000000000000000000000000000002A05A1CE710E5009C0C0F8D5F8D1A0C32F01ACBCB01E6381F60C118F291090946CCC0AA961489D404335FFFB81DF71A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0FE5383F13A0FDE496E6737D1E5B55323E0416FAEE0983FBE399D336F7B58A191A000000000000000000000000000000000000000000000000000000000000000008340B0D10F8609184E72A000830F09658084536AD02780A00000000000000000000000000000000000000000000000000CD0D5909EC1996AC0C0F8D5F8D1A0D4D3BC8A0CE547D9E2EC49475F0BDC092F9744F04900D388EEBE7A99A733BB17A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0397EE5E3270CD4521E05048CC7D777C0F5D7592F438BC95CBCE7FCAED9DAA9B8A000000000000000000000000000000000000000000000000000000000000000008340A0A90E8609184E72A000830F0D298084536AD02480A000000000000000000000000000000000000000000000000037AA51DB21383761C0C0F8D5F8D1A0D7B98EAB92E9B4BE7447DA779B91528F7C64E904BEC37E2118CFE9BCAF742455A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0423459C9544507C7CFBE879A9980709213F3BABF3EDA6366137AB75C0B571287A000000000000000000000000000000000000000000000000000000000000000008340B0D50D8609184E72A000830F10EE8084536ACFE880A0000000000000000000000000000000000000000000000000433536CC4254685CC0C0F8D5F8D1A00786B6D216BA1504ADB1BE9A2A5641E2D29C7E5B76A7499FDE0AC3AFAE9C430EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0F572DC64264D572D306A158A988A1E59D3B1239CBA5A7B41BD1EAA5CFF34EF17A000000000000000000000000000000000000000000000000000000000000000008340A0AD0C8609184E72A000830F14B48084536ACFE180A00000000000000000000000000000000000000000000000003292DD4BF23421C9C0C0F8D5F8D1A02D8D2E0E39972F1C3312C69E31F234FD3815629CF99054609FABEAE535003F16A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA08E759E25A406E0D8DCF0A208911B6BBA014F857219BD7AD9AD9C2FE7DBC3955FA00000000000000000000000000000000000000000000000000000000000000000834090890B8609184E72A000830F187B8084536ACFDE80A00000000000000000000000000000000000000000000000004285B36769517C59C0C0F8D5F8D1A04EE80D4C2C076A8EEE49AF40EBA6BD1B9C8BCC260A21538E50300886EE95DB2DA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0B2EA0D776870D3ED426C7FE68B202F213C064499E7EF237E0B93422F515A1D79A00000000000000000000000000000000000000000000000000000000000000000834080690A8609184E72A000830F1C438084536ACFD080A0000000000000000000000000000000000000000000000000DA58C863E0B19CDFC0C0F8D5F8D1A0E1EBC899ECF44D7BD08B2B9F2A80CF60CDA30049724EA20C6BCFF45563C59660A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0FA4013D37280A1F36BDF799163D8010019C093EEB6B3726F607D815D62E459F8A000000000000000000000000000000000000000000000000000000000000000008340704D098609184E72A000830F200C8084536ACFCA80A000000000000000000000000000000000000000000000000085C4CB652CFFA8F3C0C0F8D5F8D1A0D7B79F0B2D4B17DD969B991770CF0B3EFE29EE2DF2C55C710D94DFF4F74CE3A8A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0CE6C714D1DFB5ECDFEC5D1E7AF7986477FB9D87C3835200ED74B0F255BA40BE5A0000000000000000000000000000000000000000000000000000000000000000083406035088609184E72A000830F23D58084536ACFC480A0000000000000000000000000000000000000000000000000300B0B1CA608281DC0C0F8D5F8D1A0A92337792EDFB865166C93E433BE2DDA63F0CE37004925BF4AAEDA46B83A7B52A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA08B25F5CED570811E1792ABA151E7ED17D535F3A4DF1B86BB8B7BBDF9D7F6470AA0000000000000000000000000000000000000000000000000000000000000000083405021078609184E72A000830F279F8084536ACFBC80A0000000000000000000000000000000000000000000000000298151B815223E6BC0C0F8D5F8D1A0B8F5577B1BC38653F52A09BECF04A44A68474395519E4E91A6B371D62F49902FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0DF793DF3C3008B4463BFA1C94F1046D68AB41A69F18B88CF41533F4FD0D85EF1A0000000000000000000000000000000000000000000000000000000000000000083404011068609184E72A000830F2B6A8084536ACFB780A00000000000000000000000000000000000000000000000008ABD522341166C97C0C0F901A6F8D3A0736E8F8996B0636061EB452EBEC32202FA5A9913C8351CAB7B01AE55FA44A74CA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA068032D387A18C14BBDCF66238E6407C91A5A0B4FEC928A0C09BC4C32DA379DE6A04B14550E0BAF8AF001834D206CED5B38A52F5152BF4D528B29A53AACB4B7136783403005058609184E72A000830F2F3582033484536ACFA680A0000000000000000000000000000000000000000000000000A7743302CFE78170F8CEF8CCF8A6808609184E72A0008227109491A10664D0CD489085A7A018BEB5245D4F2272F180B840000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011CA0C2604BD6EECA76AFCE4E7775D87960E3D4ED3B69235A3F94D6F1497C9831B50CA0664124A6B323350DD57A650434DC6BF8DDF37CD1A2686FEE377E512AA12F1214A0C84F20B2DF6ABD635BABD7AF64CD76756CD4E39C0CCB87EAAAAD609F21D1FE51820334C0F8D5F8D1A05B94E79DF6CB0B7E0843D04ABB84C4DE9BC2ECA8C83E36FEB8207B70534E016FA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0170C9F783B7417E30A163B1D99E69E4A9F39A290F8A0E0B256A2A1FE47A3763BA0000000000000000000000000000000000000000000000000000000000000000083401FFE048609184E72A000830F33028084536ACF9980A0000000000000000000000000000000000000000000000000DCBF8185EA378113C0C0F8D5F8D1A0473555DAAA9009B63CE3B73EB97896BE9855ECC29747F9052653F963989D9D73A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA0EDFAF013D7013A9C8F3BD558DC75CEB843EF5C61BA3500DD6907C90F1BE14ECCA0000000000000000000000000000000000000000000000000000000000000000083400FFB038609184E72A000830F36D08084536ACF8C80A0000000000000000000000000000000000000000000000000168588EFEC6C48D6C0C0F8D5F8D1A0A4F0DC5F3FB71FA985DC2918583309AF09EFA63913CC688B3399B30BE1C45903A01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA037918898EBCFF51F2E982E7FBAB00868DF4A5F7BDE877FCFF7E8CA4CDE3730A9A00000000000000000000000000000000000000000000000000000000000000000833FFFFC028609184E72A000830F3A9F8084536ACF8980A00000000000000000000000000000000000000000000000004D34A8977127054CC0C0F8D5F8D1A069A7356A245F9DC5B865475ADA5EE4E89B18F93C06503A9DB3B3630E88E9FB4EA01DCC4DE8DEC75D7AAB85B567B6CCD41AD312451B948A7413F0A142FD40D4934794202EFA7E3C2AADE2504A7C38E94AB6FEBCAFF43DA04EE90524267FAAAD6DCA5B718572765ABD84530EABC3286261C12031154B270EA00000000000000000000000000000000000000000000000000000000000000000833FF000018609184E72A000830F3E6F8084536ACF6E80A0000000000000000000000000000000000000000000000000754782FD1D03E7ADC0C0";

        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = RLP.decode2(payload);

        BlocksMessage blocksMessage = new BlocksMessage(rlpList);
        List<Block> list = blocksMessage.getBlockDataList();
        System.out.println(blocksMessage);

        Block block = list.get(0);
    }

    @Test /* GetChain encode */
    public void test14() {

       String expected = "F86514A0B4986B41E57B351FD037775A4D439443B4BDE859D061D772117AFA855BFDE18EA0241A2A72372AD63C40704C93CD380A51FEE174EB59501D731A009F51372E5205A0E963653D860F35E27A5572CFEECE1BB518C42BB97DEAC0978FA788F6DCB45CF764";

       String hash1 =  "B4986B41E57B351FD037775A4D439443B4BDE859D061D772117AFA855BFDE18E";
       String hash2 =  "241A2A72372AD63C40704C93CD380A51FEE174EB59501D731A009F51372E5205";
       String hash3 =  "E963653D860F35E27A5572CFEECE1BB518C42BB97DEAC0978FA788F6DCB45CF7";

       GetChainMessage getChainMessage =
            new GetChainMessage((byte)100, Hex.decode(hash1),    Hex.decode(hash2), Hex.decode(hash3));

        assertEquals(expected, Hex.toHexString(getChainMessage.getPayload()).toUpperCase());

        byte[] size = ByteUtil.calcPacketLength( getChainMessage.getPayload());

        assertEquals("00000067", Hex.toHexString(size));
    }

    @Test /* Transactions msg encode */
    public void test15() throws Exception {

        String expected = "f87312f870808b00d3c21bcecceda10000009479b08ad8787060333663d19704909ee7b1903e588609184e72a000824255801ca00f410a70e42b2c9854a8421d32c87c370a2b9fff0a27f9f031bb4443681d73b5a018a7dc4c4f9dee9f3dc35cb96ca15859aa27e219a8e4a8547be6bd3206979858";

        BigInteger value = new BigInteger("1000000000000000000000000");

        byte[] privKey = HashUtil.sha3("cat".getBytes());
        ECKey ecKey = ECKey.fromPrivate(privKey);

        byte[] gasPrice=  Hex.decode("09184e72a000");
        byte[] gas =      Hex.decode("4255");

        Transaction tx = new Transaction(null, value.toByteArray(),
                ecKey.getAddress(),  gasPrice, gas, null);

        tx.sign(privKey);
        tx.getEncoded();

        List<Transaction> txList =  new ArrayList<Transaction>();
        txList.add(tx);
        TransactionsMessage transactionsMessage = new TransactionsMessage(txList);

        assertEquals(expected, Hex.toHexString( transactionsMessage.getPayload()) );
    }


    @Ignore
    @Test
    public void test16() {
        String blocksRaw = "f8b7f8b3a03f1d6b037f0b9cf0e0b638f4f82574acce17b36ea257017e36b3183252bc50e2a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794e0f38e78d62c92f8f26b1f6af5cb57877e2240089100001ca5f91ca213";


        byte[] payload = Hex.decode(blocksRaw);
        RLPList rlpList = RLP.decode2(payload);

    }


    @Ignore
    @Test /* Block msg decode - found bug tool */
    public void test17() throws URISyntaxException, IOException {

        URL rlpMsg_1 = ClassLoader
                .getSystemResource("rlp/rlp-msg-1.dmp");

        File file = new File(rlpMsg_1.toURI());
        byte[] strData = Files.readAllBytes(file.toPath());
        byte[] data = Hex.decode(new String(strData));

        RLPList rlpList = RLP.decode2(data);


        BlocksMessage msg = new BlocksMessage(rlpList);
        msg.getBlockDataList().get(0);


        System.out.println(msg);


    }
}

