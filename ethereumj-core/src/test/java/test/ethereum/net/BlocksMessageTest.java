package test.ethereum.net;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNull;

import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.net.URL;
import java.nio.file.Files;
import java.util.List;

import org.ethereum.core.Block;
import org.ethereum.net.eth.BlocksMessage;
import org.junit.Ignore;
import org.junit.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.spongycastle.util.encoders.Hex;

public class BlocksMessageTest {

    private static final Logger logger = LoggerFactory.getLogger("test");

    /* BLOCKS */

    @Test /* BlocksMessage really big message parsing */
    public void test_1() {

        String blocksRaw = "f9339416f93390f90138a0ebc60a31c19975e4b0e965d450f76343b3329f170d1669c0748a0f20ef75b705a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347947fda239cccacf704ecd59ff2d21b27f40f40e9cfa054fb8d2f4641518b8ef6919fe2489e9ab85e811d32d1e95338c286779393cc06a0cba2daf227a25589c73cba8c02d90a68c6172a76276b3de27d1e5408585ab361a04f74441e5e3d67ecc99ca1852124a16004c9717d6e606dd143d15693a380d9d9b8400000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000080000000000000000002000000000000082f2f08258ff8609184e72a0008301e8488301d1b7845460278e80a0e560621eac742eb5982ea5a78c88256b63db6e161efaa72b5b537bbd90cd7257f93251f885088609184e72a00082271094a129a36146edcf524b8700420c3b16a4bb7f212280a06b696c6c000000000000000000000000000000000000000000000000000000001ba0d3b3a548bd62fd611b9bf58c65e8d457aa923686461461e8fb2cecffe849329ca04bf07edca2f3a3b13d68c89d554ea9560d4ffe070eca168c2d91b538f5920c16f9046f098609184e72a0008227108080b9041c336045557f30782066756e644164647265737300000000000000000000000000000000000060805560ff7f30782073746174696341646472657373310000000000000000000000000000005560ff7f3078207374617469634164647265737332000000000000000000000000000000556103568060c660003960006000f060a055603980608d6000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156031575060455433145b1560385733ff5b3360c0556103458060116000396000f20061010060e0526040355060e051546026576101668060df60003960006000f060e05155607c565b60007f7472616e736665720000000000000000000000000000000000000000000000006101201415605957503360e05154145b60615700607b565b6020356101405561016180607e60003960006000f060e051555b5b003360a05561011e8060436000396000f26000600060006000610140547f6e65774f776e657200000000000000000000000000000000000000000000000060e05154f10060007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561005157503361016054145b1561005e57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100b057503361018054145b156100c157600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561011357503361018054145b1561011d5760a054505b3360a055336101405561011e8060486000396000f26000600060006000610140547f6e65774f77656e6572000000000000000000000000000000000000000000000060e05154f10060007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561005157503361016054145b1561005e57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100b057503361018054145b156100c157600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561011357503361018054145b1561011d5760a054505b1ba0ada9e916e9f129dffe5e5fcf504a7ea21e2c9541d842a303ec8b8481b27a1c31a051df1ef48b6832d22bc5867e53e2d2210008a2474e7aea11d6f753f219a012cbf8850a8609184e72a00082271094467d68f943c0110bf0f34212170a12b4141b7bcc80a000000000000000000000000000000000000000000000000000000000000000de1ca040c4b0bff7a3114b8b771c70190e385e87e7edd5469c60c9127946cbd3dfb041a0f4f4daedf7a18c9e4bc062240f99204ff1076b8c04e14d86c59fb77b28cab9e7f8b50b8609184e72a0008227108080b863605780600c6000396000f20060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415604f57507f307865373162323864633065376135393762323631306636306534326334663333145b1560565733ff5b1ba0e8b009337290ec30fff9426d4f45e4fca3f981bf7cd0ea520b7140fed0fb82c0a03d360635682e8b8d59b87453c1a8570eaee13b54524ee3172622f5a4ed9e289ef8850c8609184e72a00082271094467d68f943c0110bf0f34212170a12b4141b7bcc80a06b696c6c000000000000000000000000000000000000000000000000000000001ca08370743c18e0d5f381292396696f10edd72bde41ca5611bed5e071fc88db90bca0cd19296eb49c5e1a8aeca252d5531c920296d7641f4bf763fe191f7ac164538bf8850d8609184e72a000822710948969fb72d175dfad6c7f7dc1d677ca7d49d339a880a06b696c6c000000000000000000000000000000000000000000000000000000001ba0f13e54f2bb4c5fdd7259319ec92037eaafea292bb4ae6ec76c9bbfd156df3afda0c16668c507b4ad39b2bfe051da58637ebbc670317ca7909358c9db90ab29f3d4f8850e8609184e72a000822710948969fb72d175dfad6c7f7dc1d677ca7d49d339a880a06b696c6c000000000000000000000000000000000000000000000000000000001ba0095863aa19bd0813b69c3373d91cbfc2d08018ca9c7632f8f21a408bddd9b952a0ace5ae060840a721c64c3a42607d9ceec871823a9590bc00155e5b8a1563345bf8a00f8609184e72a0008227108080b84e33604555608060465560398060156000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156031575060455433145b1560385733ff5b1ca04293ba8f8e4f189ab121d346b5ec4dc03a11ac1ada0eec6b905a36ed13491f59a09b582b238f915e8a3788ac11b068c23e8ef4f04f60e8c55acfef16c75ea02a52f8af108609184e72a0008227108080b85d73e71b28dc0e7a597b2610f60e42c4f3f28c6484b560455560398060246000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156031575060455433145b1560385733ff5b1ba06b240ce6e81f2a5316fb73cb75c79ad8fb74a341502ac0e139bbd1361a939997a05571652fc4ece5a7277fec81e58f127bcfb3da0b2b7548aeaf25683f739f4ffbf885118609184e72a00082271094e95f9bfb953a8c7d6032273d802e3ecb7ba712dd80a06b696c6c000000000000000000000000000000000000000000000000000000001ca0d4574fcdfb5155f138e3c38135db949fbdbd7f92a2621fa1074d2fa581e7bd7fa0f680c8c5ea178d06d6e64d5ff7a776b0afb334b9e75b3bb3a34d2c4f481337d3f885128609184e72a000822710948dfbf6e1e1ee8dd807eb73fba4c133efd1df45d980a06b696c6c000000000000000000000000000000000000000000000000000000001ba03579769c139925ef6bd9f1d24786b28f63bcf8b668b4198c31dc9bad1c3a6143a04b5c74ae936696f7eecf9d90509bff74f0bb39eb31d9334401fcfe42b87e9ecff8a6138609184e72a000822710948dfbf6e1e1ee8dd807eb73fba4c133efd1df45d980b840000000000000000000000000e71b28dc0e7a597b2610f60e42c4f3f28c6484b500000000000000000000000000000000000000000000000000000000000000de1ca0fa5b5c27f29b1fdc66f8b26467dcf612d7d01eba0815fa2cc65404748baa127aa09a969f0994c51ba7835dc7c822bf73e25fe2a70c8e130e1b573280f568c35656f8a6148609184e72a000822710948dfbf6e1e1ee8dd807eb73fba4c133efd1df45d980b840000000000000000000000000e71b28dc0e7a597b2610f60e42c4f3f28c6484b500000000000000000000000000000000000000000000000000000000000000de1ca0230786cf3dbda0ca46c5c57f81ad1fbdeeda73416af7d487d36b71b8815e14baa0f0f2bba02a1f4ae1387f717a4ccb9cc390636acf05b88c0edb3a499df5628387f8b3158609184e72a0008227108080b8613360455573e71b28dc0e7a597b2610f60e42c4f3f28c6484b560465560398060286000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156031575060455433145b1560385733ff5b1ba0b593e2837c2c5a4d45129fc10ddf86c80c0cb76f8ee53f99a87b2f6faf5d1539a057b918fde436b8ee64cea66cdcf6ec92891887ad2617012bb1dc2127846cef2bf8af168609184e72a0008227108080b85d73e71b28dc0e7a597b2610f60e42c4f3f28c6484b560455560398060246000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156031575060455433145b1560385733ff5b1ba0354722d04cd298f5eb86290c722ce591614600a6e8e0c207e4cd53b44f5cdd4ba03e5f5d99447f09021e48ce081872f1f3ce9d11af867184e0cf96a2db903b4df4f865178609184e72a00082271094badada73290fe66990bb7ab66c4343c02d5f4c1c80801ba0ff92367fcce5c59bf614543dbea0c0af592842953acfd50d558962d381ce4c09a0f0431652632ced2083bbbc3599f326b74d656492448cfcf90558fcefea8a947df865188609184e72a00082271094d920d79e3ab35799a3f579807c89f7f0561f1fbb80801ba0bbf7b05d3399f4eed39c61b1a4a8b85f63b778e93bcc3ffc2c5c0b4eff2ce136a06d5cac2dd10eb94432d79fe32965e62c3453244fc089940aa6128d0874beb5c1f865198609184e72a00082271094e80e7941096fc8dfc72fa42dca23e595975a54a880801ca0cd139f9807590b7ab3f1d7e85f0fd6737d6509bad98edad095d8cc5f9f2f9876a044bc64a323ad77d42257f01b329aeb61d787c13ab34f82886ecfd1590876be96f8a91a8609184e72a0008227108080b857604b80600c6000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b1ba08c642da379173718a2609b0bd9c26a8f8aa0fe26daece557851b9893b1da26d4a0cdb7bd079f18ba55f3edbc3ebdcc88848e21226ba00728d4838bbff1c575fcc2f8851b8609184e72a00082271094e80e7941096fc8dfc72fa42dca23e595975a54a880a06b696c6c000000000000000000000000000000000000000000000000000000001ba0bebe1f6705e6ecba80b5c01877cbbc56aacad6c4142ae38a6d192c732c970240a07a3dd2c507a9f252846bb821236eda25172d5b46cf4f015e0098334f74ad2d10f8651c8609184e72a00082271094d920d79e3ab35799a3f579807c89f7f0561f1fbb80801ca0c51ff787173b97c2b929c455a8884709613ef0cf2984e2054b097b6b69f84022a09d120bb322e968e84b8c686e67df98b10f02134c397890ac8b42e1e7138dbe76f8851d8609184e72a00082271094d920d79e3ab35799a3f579807c89f7f0561f1fbb80a06b696c6c000000000000000000000000000000000000000000000000000000001ba089cc16d674ca351456dce0778babd5705555ecc1f693d0914f8375c3485cb97fa0654c61cf05df7c3fb3a4180b4529fa33056db89d70cf816a5f05e277ce69786ff8851e8609184e72a00082271094badada73290fe66990bb7ab66c4343c02d5f4c1c80a06b696c6c000000000000000000000000000000000000000000000000000000001ca0c153b670ffa323e1b10632b33607ac98c7463c2f7cff2b3022f83f6eed5b1813a0e05505d1be246b088067e0fcc3971bc01d505e75ec7a728e34892a0a94c48296f905661f8609184e72a0008227108080b90513336045557f30782066756e644164647265737300000000000000000000000000000000000060805560ff7f30782073746174696341646472657373310000000000000000000000000000005560ff7f30782073746174696341646472657373320000000000000000000000000000005561043b8060d860003960006000f060a055604b80608d6000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b3360c05561042a8060116000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b61010060e0526040355060e051546071576101b38060c960003960006000f060e0515560c7565b60007f7472616e73666572000000000000000000000000000000000000000000000000610120141560a457503360e05154145b60ac570060c6565b602035610140556101ae80607c60003960006000f060e051555b5b003360a055336101405561016b8060486000396000f26000600060006000610140547f6e65774f77656e6572000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b3360a05561016b8060436000396000f26000600060006000610140547f6e65774f776e657200000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b1ba02076ac62b937cf962101119216d4e103e2fae88f45a875a77a70d0193b2a4aa3a0061c25445dc00af889784cac16f2a62bfc120b1e7681c2ca914af390e602add0f885208609184e72a0008238f5944e1166d7eff58898af02cc28dde14e2f4848b04d80a06b696c6c000000000000000000000000000000000000000000000000000000001ca0d1f1a131f8c5af602b8ad00ad2277c689484fb9fae28c4e55e11ae94c86aebdaa028a7bfe9fdb9bb17240f4cb92fb9c4f29254d353fa2fe33842c920233ae79e35f885218609184e72a0008238f5948cd870f373fc63dac6e42d31a142c3d1e428d42c80a06b696c6c000000000000000000000000000000000000000000000000000000001ba0824902cf09d74a274112298fa1838662f7a2a8a69efa75d5dc5872135720dbc3a0f2a3e1e0e333da00b44598183f69d12a4ef574800848890530bd66dddaa33cf0f90566228609184e72a0008238f58080b90513336045557f30782066756e644164647265737300000000000000000000000000000000000060805560ff7f30782073746174696341646472657373310000000000000000000000000000005560ff7f30782073746174696341646472657373320000000000000000000000000000005561043b80608d60003960006000f060a055604b8060c86000396000f2003360c05561042a8060116000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b61010060e0526040355060e051546071576101b38060c960003960006000f060e0515560c7565b60007f7472616e73666572000000000000000000000000000000000000000000000000610120141560a457503360e05154145b60ac570060c6565b602035610140556101ae80607c60003960006000f060e051555b5b003360a055336101405561016b8060486000396000f26000600060006000610140547f6e65774f77656e6572000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b3360a05561016b8060436000396000f26000600060006000610140547f6e65774f776e657200000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b60007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b1ca0a40a8a2c3cfbe0b64a3d9deefd9969c5f8aef70aa5def4807192bd8ad2a4f439a0df3ed3e85ac94ecf276069e68bba1ff1e8fc8076a0b73a17156834508b65a3abf885238609184e72a0008238f594ed7e1aa4d9e666bcf997306b1cb2c5d5396107a080a06b696c6c000000000000000000000000000000000000000000000000000000001ba0598e1d956c67f1194abb7bbc3d698dad02c349e6a37ba7d681220aa3ab23671ca09856f06420cb1bcafaa5b5dbd613df56f25e198dbd5e496ca0719c3823a10610f885248609184e72a0008238f59445a82a87f0e06d36acbd45621b362faee2f9625380a06b696c6c000000000000000000000000000000000000000000000000000000001ca040a0df348b6af5e0724c0a3f64dfd91d6471aa53aa7d168039f9a32e33f4568ca02ec919453ab4468d9c47f547156dc27b8ebefe69449dfe0dfc8359a422cbe17ef885258609184e72a0008238f594ed7e1aa4d9e666bcf997306b1cb2c5d5396107a080a06b696c6c000000000000000000000000000000000000000000000000000000001ba05fdc8c131a6122e46a7d327154ccdf070aed0ae82dba05b66eade1dd816cdf00a0c02473cb22b09ef467051a11e393cef4c9da25e72a2bb8e75c18e73b518b03bbf885268609184e72a0008238f5941ee3e96e1d2af537a8aadf93f2fbce05ea2061eb80a06b696c6c000000000000000000000000000000000000000000000000000000001ba037a471a56aad4c159dd55b2994f16a4fa2cf987aef802e2da8afa6fc98e4d4f5a01ec7b53df234cbe6e7c32b6ad5d0349c5c79a55dd053ab7aec72d928b239ff99f90b67278609184e72a0008238f4941ee3e96e1d2af537a8aadf93f2fbce05ea2061eb80b90b0000000000000000000000000000000000000000000000000000000000000000ce000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000add0000000000000000000000000000000000000000000000000000000000000ada000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000face000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000def0000000000000000000000000000000000000000000000000000000000000def000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000def00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000def000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000ff00000000000000000000000000000000000000000000000000000000000000ff000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000be000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de0000000000000000000000000000000000000000000000000000000000000def000000000000000000000000000000000000000000000000000000000000000d0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000ad000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000ed000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000ad000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000def00000000000000000000000000000000000000000000000000000000000000ad00000000000000000000000000000000000000000000000000000000000000ad000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000def00000000000000000000000000000000000000000000000000000000000000ad00000000000000000000000000000000000000000000000000000000000000ad000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de1ca057b1b28d6b77749ba7638eabc1be977ed54c7333c486ccfd5e1f6cb170b67564a0512c893e3d84c2aa9ad34f621255f00ae1d5231a46859d98b1d3a1d26bd7f85df90566288609184e72a0008238f58080b90513336045557f30782066756e644164647265737300000000000000000000000000000000000060805560ff7f30782073746174696341646472657373310000000000000000000000000000005560ff7f30782073746174696341646472657373320000000000000000000000000000005561043b80608d60003960006000f060a055604b8060c86000396000f2003360c05561042a8060116000396000f20060007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b61010060e0526040355060e051546071576101b38060c960003960006000f060e0515560c7565b60007f7472616e73666572000000000000000000000000000000000000000000000000610120141560a457503360e05154145b60ac570060c6565b602035610140556101ae80607c60003960006000f060e051555b5b003360a055336101405561016b8060486000396000f26000600060006000610140547f6e65774f77656e6572000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b3360a05561016b8060436000396000f26000600060006000610140547f6e65774f776e657200000000000000000000000000000000000000000000000060e05154f10060007f6b696c6c000000000000000000000000000000000000000000000000000000006000351415610044575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b1561004c5733ff5b60007f6e65774f776e65720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561009e57503361016054145b156100ab57602035610180555b60007f76657269667900000000000000000000000000000000000000000000000000007f616374696f6e000000000000000000000000000000000000000000000000000014156100fd57503361018054145b1561010e57600160005260206000f2005b60007f7472616e736665720000000000000000000000000000000000000000000000007f616374696f6e0000000000000000000000000000000000000000000000000000141561016057503361018054145b1561016a5760a054505b60007f6b696c6c0000000000000000000000000000000000000000000000000000000060003514156043575073e71b28dc0e7a597b2610f60e42c4f3f28c6484b533145b15604a5733ff5b1ca0912c887cd5f1d3d02bceb22d37e7f1541174eb9fe27f63631ed351191bc150c6a04ac734ba5449651d047c389c939de9f6d6a786bd2dc5f0596b687fb9f2264017f8a6298609184e72a0008238f594a914a163554f3d049a1afeb50fa64e341f54f40080b840637265617465000000000000000000000000000000000000000000000000000061626300000000000000000000000000000000000000000000000000000000001ca044756539da1e0879bc8759a0032bc7a44efd609f81f313be9cca2d86ce636750a0b56c22f2a4856a485abc162ff7d2df32e478ae3552580019b3e2675f796f559df8852a8609184e72a0008238f594a914a163554f3d049a1afeb50fa64e341f54f40080a06b696c6c000000000000000000000000000000000000000000000000000000001ca0523a78ffef6dd132e85386150e41c8a91fe0f9bd955596b477fdf4bd6295d5a7a07e85123566e76895e99909c80b3fd8acaa90c12348b2f59f6e6c9a5be3435796f8852b8609184e72a0008238f59485b0375dcfa4e018c4cefa21681cf77303bfb2ce80a06b696c6c000000000000000000000000000000000000000000000000000000001ba0294c826752dfde0a2fabde10ae4a038a0ee047d95a366981ad5f5c59e061c9b6a034cbcbb729c61ddb71105c0245593ec1111def29f6e9629c5a841b293059b266f8842c8609184e72a0008238f5948dfbf6e1e1ee8dd807eb73fba4c133efd1df45d980a06b696c6c000000000000000000000000000000000000000000000000000000001c9fde64adaf932dcce00a7abaace8cbd5a5604e9f0ba4edae999beb2a41b7d038a02eed4f96ced86d888570ddb8d5af7fdb4d3abc69321368ff3d82230814980b60f8852d8609184e72a0008238f594a45e138444d53ee1ee925229e37a8241c2110e5980a06b696c6c000000000000000000000000000000000000000000000000000000001ba05ac414ed440b446eb0a0ddd9341fb6627c0bbff287d939abc7c1b41cf3683de6a09f2600719b016cc3c571d264a2f0a982e6fd9c4f308acb58fb37360981332a67c0";

        byte[] payload = Hex.decode(blocksRaw);

        BlocksMessage blocksMessage = new BlocksMessage(payload);
        List<Block> list = blocksMessage.getBlocks();
        logger.info(blocksMessage.toString());

        Block block = list.get(0);
        assertEquals(38, block.getTransactionsList().size());
        assertEquals(22783, block.getNumber());
        assertEquals("a6fa4bbd52734c654ce0f8420eecfc7b81fa23dd427829d40ee8a119039fba1a",
                Hex.toHexString(block.getHash()));
        assertEquals("54fb8d2f4641518b8ef6919fe2489e9ab85e811d32d1e95338c286779393cc06",
                Hex.toHexString(block.getStateRoot()));
    }

    @Test
    public void test_2() {

        String blocksRaw = "f901aa16f901a6f90137a0426ec7d3a5397801f927ec43fa3bf4d632a9b78ab2726a02aaf9d92b0764e407a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794f92c0f3e4825f09490ca264dc0cdacffeb566f06a0396d2ff722ae3811cb5deb69270933c8016f2397a5189aac429bc6fc466607bba034ade8aa1bcc3aaaa9211ef3ff6c654898034e8dadcf97375c7a9bb9a0040a49a0336e21fc7b24e124884ab67adafa5bc89e03fee9612620ed790e34dc50beed68b8400000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000010000400000000000000000000082ec30820f478609184e72a0008301e8488201f484545c2bbc80a01cba64e27a88b7f679858d56439122006bb0b03688998eb0bcbad9e14a286795f869f867821a138609184e72a0008203e894885f93eed577f2fc341ebb9a5c9b2ce4465d96c40c801ca0fd5c7e9ffcba7212ba9c669022a4c32e63a167b69da3d2f984a1b30508b52764a009d0578b89c12acb48042fc5da0b1be18776e2b14112071e5913b3bdfeaf4d45c0";

        byte[] payload = Hex.decode(blocksRaw);

        BlocksMessage blocksMessage = new BlocksMessage(payload);
        List<Block> list = blocksMessage.getBlocks();
        logger.info(blocksMessage.toString());

        Block block = list.get(0);
        assertEquals(1, block.getTransactionsList().size());
        assertEquals(3911, block.getNumber());
        assertEquals("140446b9f55bbbe9bad9fe963157cf0fc6ab2d068433eb95e161847f197362b2",
               Hex.toHexString(block.getHash()));
        assertEquals("396d2ff722ae3811cb5deb69270933c8016f2397a5189aac429bc6fc466607bb",
                Hex.toHexString(block.getStateRoot()));
    }

    @Test
    public void test_3() {

        String blocksRaw = "f9021316f9020ff90137a0986cff0ebad855d786464e5d080c0c4bd81289b6b08feb98df038fbc22ae3a7ca01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794f92c0f3e4825f09490ca264dc0cdacffeb566f06a014fd76260a37d307936e721ed7999c61e58dfc42b2680a6de01de2aa80fece52a0a41b6702988f5c9aa4c428d050a9fbd7821c5032daeb9c04a0ce72932cb8cd58a04e4c819c66c4602657e2ca08a55cbc12ede988ebdd3ee7f2ccf2c87083039ee0b8400000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000010000400000000000000000000082f10d820eee8609184e72a0008301e8488203e884545c28ee80a0126e01943d13ca185cbb478f171af4bb3414deed270bbf4a179e9e4d191a8faff8d2f8678219878609184e72a0008203e894885f93eed577f2fc341ebb9a5c9b2ce4465d96c40c801ca0f2c8f181b6752e71f5f32184fee5d826ec1d96a93ba6fc659eb8897494ac1e99a071b43f5cb2a5b7534f9cbe492bc4baea648b434c187821ef7b2bc87973b40a89f8678219888609184e72a0008203e894885f93eed577f2fc341ebb9a5c9b2ce4465d96c40c801ca0e3799545400eb66e75c51d99eb0ffbbcc241b32fd4b8a39db49f9104111cac31a01b9fcdc1164e01f1975f74d9ec12ba92e750fbf20ea57dae527c5d185ca24db7c0";

        byte[] payload = Hex.decode(blocksRaw);

        BlocksMessage blocksMessage = new BlocksMessage(payload);
        List<Block> list = blocksMessage.getBlocks();
        logger.info(blocksMessage.toString());

        Block block = list.get(0);

        assertEquals(2, block.getTransactionsList().size());
        assertEquals(3822, block.getNumber());
        assertEquals("faced238a53a0bf1cd13c93e9fe1329e165e6d90d1c19aa1babd7d851cebad8f",
                Hex.toHexString(block.getHash()));
        assertEquals("14fd76260a37d307936e721ed7999c61e58dfc42b2680a6de01de2aa80fece52",
                Hex.toHexString(block.getStateRoot()));

    }

    @Ignore
    @Test /* Block msg decode - found bug tool */
    public void test_4() throws URISyntaxException, IOException {

        // f8b3a014d130c317eb9440123b1db01bfb1f2e081d83200216bc032d7de2fc9ff3b46ba01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794e559de5527492bcb42ec68d07df0742a98ec3f1ea063bb3d8f8428483b2dfd838bef3e7fba6df53fd088f176a4831065f36b93346a808372c7b0821e448609184e72a0008301e848808453c9b36980a078cc350ffafd409d918e0a015dcfa0bddeec4637fe266da36298577aa13173ad

        URL rlpMsg_1 = ClassLoader
                .getSystemResource("rlp/rlp-msg-1.dmp");

        File file = new File(rlpMsg_1.toURI());
        byte[] strData = Files.readAllBytes(file.toPath());
        byte[] data = Hex.decode(new String(strData));

        BlocksMessage blocksMessage = new BlocksMessage(data);

        int size = blocksMessage.getBlocks().size();
        for (int i = 0; i < size; ++i){

            Block block = blocksMessage.getBlocks().get(i);

            int unclesSize = block.getUncleList().size();
            for (int j = 0; j < unclesSize; ++j) {
                System.out.println("*** uncle: " + Hex.toHexString(block.getUncleList().get(j).getCoinbase()));
            }

            System.out.println(block);
            System.out.println("===============================");
        }
    }
}

